<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lord Anwith - Wood Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <style>
    /* 1. Mobile Optimization */
    body { 
      margin: 0; 
      height: 100vh; 
      width: 100vw;
      overflow: hidden; 
      background: #2d1e12; 
      font-family: system-ui, -apple-system, sans-serif;
      touch-action: none; 
      -webkit-user-select: none; 
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    canvas { 
      display: block; 
      margin: auto; 
      touch-action: none;
    }

    /* 2. UI Overlay */
    #ui-layer {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; 
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 20; 
      transition: opacity 0.3s; 
    }

    #start-msg {
      text-align: center;
      color: #fff;
      text-shadow: 0 4px 15px rgba(0,0,0,0.9);
      animation: float 3s ease-in-out infinite;
    }

    h1 {
      font-size: 3rem;
      margin: 0;
      font-weight: 800;
      background: -webkit-linear-gradient(#fff, #ffc107);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 4px 4px rgba(0,0,0,0.8));
    }

    p {
      font-size: 1.2rem;
      margin-top: 10px;
      font-weight: 700;
      color: #ffca28; 
      text-shadow: 0 2px 4px rgba(0,0,0,1);
    }

    /* CREDITS STYLE */
    .credits {
      margin-top: 40px;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: rgba(255, 255, 255, 0.6);
      font-weight: 400;
      border-top: 1px solid rgba(255, 193, 7, 0.3);
      padding-top: 10px;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    #debug {
      position: fixed; bottom: 10px; left: 10px; 
      color: rgba(255,255,255,0.3); 
      font-family: monospace; font-size: 10px; 
      pointer-events: none;
      z-index: 5;
    }
  </style>
</head>
<body>

  <div id="ui-layer">
    <div id="start-msg">
      <h1>LORD ANWITH</h1>
      <p>Tap Screen to Start</p>
      <p style="font-size: 0.9rem; color: #fff; margin-top:20px; opacity:0.8">Target: 10 Points</p>
      
      <div class="credits">Developed by Akash Poojary</div>
    </div>
  </div>

  <div id="debug"></div>
  <canvas id="game"></canvas>

  <script>
    const c = document.getElementById('game');
    const ctx = c.getContext('2d');
    const uiLayer = document.getElementById('ui-layer');
    const debugDiv = document.getElementById('debug');

    // --- 1. ASSETS ---
    const playerImg = new Image();
    playerImg.src = "assets/anwi13.jpg"; 

    const bgImg = new Image();
    bgImg.src = "assets/wood.jpg"; 

    // --- 2. SOUNDS ---
    const failAudio = new Audio();
    failAudio.src = "assets/ad1.mp3"; 
    
    const winAudio = new Audio();
    winAudio.src = "assets/jump2.mp3"; 
    
    const jumpAudio = new Audio();
    jumpAudio.src = "assets/jump.mp3"; 
    
    const winImg = new Image();
    winImg.src = "assets/kaup.jpg"; 

    // --- 3. RESIZE (Optimized) ---
    let gameW, gameH; 

    function resize() {
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      gameW = Math.min(window.innerWidth, 600);
      gameH = window.innerHeight;

      c.width = gameW * dpr;
      c.height = gameH * dpr;
      c.style.width = gameW + "px";
      c.style.height = gameH + "px";

      ctx.scale(dpr, dpr);
    }
    window.addEventListener('resize', resize);
    resize();

    // Game Settings
    const WIN_SCORE = 10; 

    // --- 4. GAME STATE ---
    // FEATURE 1: Load High Score from Local Storage
    let storedHighScore = localStorage.getItem('lordAnwithHighScore') || 0;

    const state = {
      running: false, 
      gameStarted: false,
      won: false,
      gravity: 0.40,    
      jumpPower: -7.5,  
      player: { x: 60, y: 0, w: 70, h: 70, vy: 0, angle: 0 }, 
      walls: [],
      particles: [],
      score: 0,
      highScore: parseInt(storedHighScore), // Load high score
      spawnTimer: 0,
      bgX: 0,
      bgSpeed: 1.5,
      shake: 0 // FEATURE 3: Shake timer
    };
    
    state.player.y = gameH / 2;

    let audioUnlocked = false;

    // --- 5. AUDIO ---
    function tryUnlockAudio() {
      if (audioUnlocked) return;
      [failAudio, winAudio, jumpAudio].forEach(snd => {
          snd.load();
          const p = snd.play();
          if (p !== undefined) {
              p.then(() => { snd.pause(); snd.currentTime = 0; }).catch(e => {});
          }
      });
      audioUnlocked = true;
    }

    function playJumpSound() {
        jumpAudio.currentTime = 0;
        jumpAudio.play().catch(e => {});
    }

    // --- 6. CONTROLS ---
    function jump() {
      if (!state.gameStarted) {
        state.gameStarted = true;
        state.running = true;
        uiLayer.style.display = 'none';
        state.player.vy = state.jumpPower;
        tryUnlockAudio();
        playJumpSound();
        return;
      }

      if (!state.running || state.won) {
        reset();
        return;
      }

      if (state.running && !state.won) {
        state.player.vy = state.jumpPower;
        state.player.angle = -0.3; 
        createParticles(state.player.x, state.player.y + state.player.h);
        playJumpSound();
      }
    }

    c.addEventListener('mousedown', jump);
    c.addEventListener('touchstart', (e) => { e.preventDefault(); jump(); }, { passive: false });

    function reset() {
      failAudio.pause(); failAudio.currentTime = 0;
      winAudio.pause();  winAudio.currentTime = 0;
      jumpAudio.pause(); jumpAudio.currentTime = 0;

      state.running = true;
      state.won = false;
      state.player.y = gameH / 2;
      state.player.x = 60; 
      state.player.vy = 0;
      state.player.angle = 0;
      state.walls = [];
      state.particles = [];
      state.score = 0;
      state.spawnTimer = 0;
      state.shake = 0; // Reset shake
      uiLayer.style.display = 'none'; 
    }

    // --- 7. MAIN LOOP ---
    function loop() {
      requestAnimationFrame(loop);
      
      // FEATURE 3: Screen Shake Logic
      ctx.save(); // Save context before shaking
      if (state.shake > 0) {
          const dx = (Math.random() - 0.5) * 15; // Random X shake
          const dy = (Math.random() - 0.5) * 15; // Random Y shake
          ctx.translate(dx, dy);
          state.shake--;
      }

      ctx.clearRect(0, 0, gameW, gameH);

      drawBackground();

      if (!state.gameStarted) {
         ctx.fillStyle = "rgba(0,0,0,0.5)"; 
         ctx.fillRect(0, 0, gameW, gameH);
         drawPlayer();
         ctx.restore(); // Restore shake
         return;
      }

      if (state.won) {
        drawWinScene();
        ctx.restore();
        return;
      }

      if (!state.running) {
        drawOverlay();
        ctx.restore();
        return;
      }

      // Logic
      state.spawnTimer++;
      if (state.spawnTimer > 110 && !state.won) {
        spawnWall();
        state.spawnTimer = 0;
      }

      state.player.vy += state.gravity;
      state.player.y += state.player.vy;
      state.player.angle += 0.02; 

      if (state.player.y + state.player.h > gameH || state.player.y < 0) {
        die();
      }

      state.walls.forEach(w => w.x += w.vx);
      state.walls = state.walls.filter(w => w.x + w.w > -100);

      for (const w of state.walls) {
        if (rectsOverlap(state.player, w)) die();
      }

      state.score++;
      let points = Math.floor(state.score / 100); 
      
      // Update High Score
      if (points > state.highScore) {
          state.highScore = points;
          localStorage.setItem('lordAnwithHighScore', state.highScore);
      }

      if (points >= WIN_SCORE) triggerWin();

      drawWalls();
      drawParticles();
      drawPlayer();
      drawScore(points);
      
      ctx.restore(); // End shake transformation
    }

    // --- 8. DRAWING HELPERS ---
    
    function drawBackground() {
        if (state.running && !state.won) {
            state.bgX -= state.bgSpeed;
            if (state.bgX <= -gameW) state.bgX = 0;
        }
        
        if (bgImg.complete) {
            ctx.drawImage(bgImg, state.bgX, 0, gameW, gameH);
            ctx.drawImage(bgImg, state.bgX + gameW, 0, gameW, gameH);
            ctx.fillStyle = "rgba(0,0,0,0.3)";
            ctx.fillRect(0, 0, gameW, gameH);
        } else {
            ctx.fillStyle = "#2d1e12";
            ctx.fillRect(0, 0, gameW, gameH);
        }
    }

    function spawnWall() {
      const gap = 180; 
      const thickness = 60;
      const speed = 5;
      const gapY = Math.random() * (gameH - gap - 100) + 50;
      state.walls.push({ x: gameW, y: 0, w: thickness, h: gapY, vx: -speed });
      state.walls.push({ x: gameW, y: gapY + gap, w: thickness, h: gameH - (gapY + gap), vx: -speed });
    }

    function createParticles(x, y) {
      for(let i=0; i<6; i++) {
        state.particles.push({
          x: x + Math.random()*40,
          y: y + 40,
          vx: (Math.random() - 0.5) * 3,
          vy: Math.random() * 3,
          life: 1.0,
          color: `rgba(222, 184, 135, ${Math.random()})` 
        });
      }
    }

    function rectsOverlap(a, b) {
      const pad = 12; 
      return a.x + pad < b.x + b.w && a.x + a.w - pad > b.x &&
             a.y + pad < b.y + b.h && a.y + a.h - pad > b.y;
    }

    // FEATURE 2: Realistic "Log" Walls
    function drawWalls() {
      for (const w of state.walls) {
        // 1. Dark Bark Base
        ctx.fillStyle = "#3E2723"; 
        ctx.fillRect(w.x, w.y, w.w, w.h);
        
        // 2. Vertical Bark Lines (Texture)
        ctx.strokeStyle = "#281810"; // Darker brown
        ctx.lineWidth = 2;
        ctx.beginPath();
        // Draw 3 lines per log
        for(let i=10; i<w.w; i+=15) {
            ctx.moveTo(w.x + i, w.y);
            ctx.lineTo(w.x + i, w.y + w.h);
        }
        ctx.stroke();

        // 3. Border
        ctx.lineWidth = 3;
        ctx.strokeStyle = "#8D6E63"; 
        ctx.strokeRect(w.x, w.y, w.w, w.h);
      }
    }

    function drawParticles() {
      for (let i = state.particles.length - 1; i >= 0; i--) {
        let p = state.particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 0.05;
        if(p.life <= 0) state.particles.splice(i, 1);
        else {
          ctx.fillStyle = p.color;
          ctx.globalAlpha = p.life;
          ctx.beginPath();
          ctx.arc(p.x, p.y, 4, 0, Math.PI*2);
          ctx.fill();
          ctx.globalAlpha = 1.0;
        }
      }
    }

    function drawScore(points) {
      // Score Box
      ctx.fillStyle = "rgba(40, 30, 20, 0.8)"; 
      ctx.beginPath();
      if (ctx.roundRect) ctx.roundRect(15, 15, 140, 60, 10); // Taller for High Score
      else ctx.rect(15, 15, 140, 60);
      ctx.fill();
      
      ctx.strokeStyle = "#FFC107";
      ctx.lineWidth = 2;
      ctx.stroke();

      ctx.fillStyle = "#fff";
      ctx.textAlign = "left";
      ctx.textBaseline = "middle";
      
      // Current Score
      ctx.font = "800 22px sans-serif";
      ctx.fillText("Score: " + points, 30, 35);
      
      // FEATURE 1: High Score Display
      ctx.fillStyle = "#FFD700"; // Gold
      ctx.font = "600 14px sans-serif";
      ctx.fillText("High: " + state.highScore, 30, 60);
    }

    function drawPlayer() {
      ctx.save();
      ctx.translate(state.player.x + state.player.w/2, state.player.y + state.player.h/2);
      ctx.rotate(state.player.angle);
      
      ctx.shadowColor = "rgba(0,0,0,0.8)";
      ctx.shadowBlur = 15;

      if (playerImg.complete) {
        ctx.beginPath();
        ctx.arc(0, 0, state.player.w/2, 0, Math.PI*2);
        ctx.clip();
        ctx.drawImage(playerImg, -state.player.w/2, -state.player.h/2, state.player.w, state.player.h);
        
        ctx.beginPath();
        ctx.arc(0, 0, state.player.w/2, 0, Math.PI*2);
        ctx.strokeStyle = "#FFD700"; 
        ctx.lineWidth = 4;
        ctx.stroke();
      } else {
        ctx.fillStyle = "#ff4757";
        ctx.beginPath();
        ctx.arc(0, 0, state.player.w/2, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.restore();
    }

    function drawOverlay() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.85)";
        ctx.fillRect(0, 0, gameW, gameH);
        
        ctx.fillStyle = "#ff5252";
        ctx.font = "900 48px sans-serif";
        ctx.textAlign = "center";
        ctx.shadowColor = "#ff0000";
        ctx.shadowBlur = 20;
        ctx.fillText("CRASHED", gameW/2, gameH/2 - 20);
        
        ctx.shadowBlur = 0;
        ctx.fillStyle = "#fff";
        ctx.font = "300 18px sans-serif";
        ctx.fillText("Tap anywhere to retry", gameW/2, gameH/2 + 30);
    }

    function die() {
      if (state.running) {
          state.running = false;
          // FEATURE 3: Trigger Shake
          state.shake = 15; // Shake for 15 frames
          failAudio.currentTime = 0; 
          failAudio.play().catch(e=>{});
      }
    }

    function triggerWin() {
      state.won = true;
      state.walls = []; 
      winAudio.currentTime = 0; 
      winAudio.play().catch(e=>{});
    }

    function drawWinScene() {
      const targetX = gameW / 2 - 60;
      const targetY = gameH / 2;
      
      state.player.x += (targetX - state.player.x) * 0.05;
      state.player.y += (targetY - state.player.y) * 0.05;
      state.player.angle = 0;
      
      drawBackground(); 
      drawPlayer();
      
      const prizeX = gameW / 2 + 20;
      const prizeY = gameH / 2 - 40;
      const prizeSize = 80;
      
      ctx.save();
      ctx.shadowColor = "#FFD700";
      ctx.shadowBlur = 30;
      if (winImg.complete) {
        ctx.beginPath();
        ctx.arc(prizeX + prizeSize/2, prizeY + prizeSize/2, prizeSize/2, 0, Math.PI*2);
        ctx.clip();
        ctx.drawImage(winImg, prizeX, prizeY, prizeSize, prizeSize);
      } else {
        ctx.fillStyle = "gold";
        ctx.beginPath();
        ctx.arc(prizeX + prizeSize/2, prizeY + prizeSize/2, prizeSize/2, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.restore();
      
      ctx.fillStyle = "#FFD700"; 
      ctx.font = "900 40px sans-serif";
      ctx.textAlign = "center";
      ctx.shadowColor = "#FFD700";
      ctx.shadowBlur = 10;
      ctx.fillText("VICTORY!", gameW/2, gameH/2 - 100);
      
      ctx.shadowBlur = 0;
      ctx.fillStyle = "#fff";
      ctx.font = "300 18px sans-serif";
      ctx.fillText("Tap to Play Again", gameW/2, gameH/2 + 50);

      if (Math.abs(state.player.x - targetX) < 5) {
         ctx.font = "40px sans-serif";
         ctx.fillText("❤️", gameW/2, gameH/2 + 10);
      }
    }

    loop();
  </script>
</body>
</html>