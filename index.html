<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Lord Anwith - Premium Mobile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <style>
    /* 1. Mobile Optimization */
    body { 
      margin: 0; 
      height: 100vh; 
      width: 100vw;
      overflow: hidden; 
      background: linear-gradient(-45deg, #0f2027, #203a43, #2c5364); 
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      font-family: system-ui, -apple-system, sans-serif;
      touch-action: none; /* Critical: Prevents double-tap zoom */
      -webkit-user-select: none; 
      user-select: none;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    canvas { 
      display: block; 
      margin: auto; 
      background: rgba(0, 0, 0, 0.2); 
      backdrop-filter: blur(5px);
      max-width: 600px; 
      width: 100%; 
      height: 100%; 
    }

    /* 2. The Title Screen Layer */
    #ui-layer {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; /* Allows clicks to pass through to canvas */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 20; /* Ensure it is on top */
      transition: opacity 0.3s; /* Smooth fade out */
    }

    #start-msg {
      text-align: center;
      color: #fff;
      text-shadow: 0 4px 12px rgba(0,0,0,0.6);
      animation: float 3s ease-in-out infinite;
    }

    h1 {
      font-size: 3rem;
      margin: 0;
      font-weight: 800;
      background: -webkit-linear-gradient(#fff, #bbb);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    p {
      font-size: 1.2rem;
      margin-top: 10px;
      font-weight: 300;
      color: #ccc;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    #debug {
      position: fixed; bottom: 10px; left: 10px; 
      color: rgba(255,255,255,0.4); 
      font-family: monospace; font-size: 10px; 
      pointer-events: none;
      z-index: 5;
    }
  </style>
</head>
<body>

  <div id="ui-layer">
    <div id="start-msg">
      <h1>LORD ANWITH</h1>
      <p>Tap Screen to Start</p>
      <p style="font-size: 0.9rem; color: #4ef2a8; margin-top:20px;">Target: 10 Points</p>
    </div>
  </div>

  <div id="debug"></div>
  <canvas id="game"></canvas>

  <script>
    const c = document.getElementById('game');
    const ctx = c.getContext('2d');
    // FIX: We select the PARENT container 'ui-layer', not just the text
    const uiLayer = document.getElementById('ui-layer');
    const debugDiv = document.getElementById('debug');

    // --- ASSETS ---
    const playerImg = new Image();
    playerImg.src = "assets/an.jpeg"; 

    // Mobile Audio: Errors handled silently
    const failAudio = new Audio();
    failAudio.src = "assets/ad2.mp3"; 
    
    const winAudio = new Audio();
    winAudio.src = "assets/ad1.mp3"; 
    
    const winImg = new Image();
    winImg.src = "assets/kaup.jpg"; 

    // Resize Logic
    function resize() {
      c.width = Math.min(window.innerWidth, 600);
      c.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // Game Config
    const WIN_SCORE = 10; 

    // Game state
    const state = {
      running: false, 
      gameStarted: false,
      won: false,
      gravity: 0.55,
      jumpPower: -9.5,
      player: { x: 60, y: c.height/2, w: 50, h: 50, vy: 0, angle: 0 },
      walls: [],
      particles: [],
      score: 0,
      spawnTimer: 0
    };

    let audioUnlocked = false;

    // --- ROBUST AUDIO UNLOCKER ---
    function tryUnlockAudio() {
      if (audioUnlocked) return;
      try {
        const p1 = failAudio.play();
        if (p1 !== undefined) {
            p1.then(() => { failAudio.pause(); failAudio.currentTime = 0; })
              .catch(e => {});
        }
        const p2 = winAudio.play();
        if (p2 !== undefined) {
            p2.then(() => { winAudio.pause(); winAudio.currentTime = 0; })
              .catch(e => {});
        }
        audioUnlocked = true;
      } catch (e) {}
    }

    // --- CONTROLS ---
    function jump() {
      // 1. START GAME (FIXED)
      if (!state.gameStarted) {
        state.gameStarted = true;
        state.running = true;
        
        // FIX: Hides the entire overlay container
        uiLayer.style.display = 'none';
        
        state.player.vy = state.jumpPower;

        // Try audio (Silent background attempt)
        tryUnlockAudio();
        return;
      }

      // 2. RESTART
      if (!state.running && !state.won) {
        reset();
        return;
      }

      // 3. JUMP
      if (state.running && !state.won) {
        state.player.vy = state.jumpPower;
        state.player.angle = -0.4;
        createParticles(state.player.x, state.player.y + state.player.h);
      }
    }

    // Input Listeners
    c.addEventListener('mousedown', jump);
    c.addEventListener('touchstart', (e) => { 
      e.preventDefault(); 
      jump(); 
    }, { passive: false });

    function reset() {
      state.running = true;
      state.won = false;
      state.player.y = c.height / 2;
      state.player.x = 60; 
      state.player.vy = 0;
      state.player.angle = 0;
      state.walls = [];
      state.particles = [];
      state.score = 0;
      state.spawnTimer = 0;
      // FIX: Ensure UI stays hidden on simple restart
      uiLayer.style.display = 'none'; 
    }

    // --- GAME LOOP ---
    function loop() {
      requestAnimationFrame(loop);
      ctx.clearRect(0, 0, c.width, c.height);

      // Intro
      if (!state.gameStarted) {
         drawPlayer();
         return;
      }

      // Win
      if (state.won) {
        drawWinScene();
        return;
      }

      // Game Over
      if (!state.running) {
        drawOverlay();
        return;
      }

      // --- LOGIC ---
      state.spawnTimer++;
      if (state.spawnTimer > 110 && !state.won) {
        spawnWall();
        state.spawnTimer = 0;
      }

      state.player.vy += state.gravity;
      state.player.y += state.player.vy;
      state.player.angle += 0.03;

      if (state.player.y + state.player.h > c.height || state.player.y < 0) {
        die();
      }

      state.walls.forEach(w => w.x += w.vx);
      state.walls = state.walls.filter(w => w.x + w.w > -100);

      for (const w of state.walls) {
        if (rectsOverlap(state.player, w)) die();
      }

      state.score++;
      let points = Math.floor(state.score / 100); 

      if (points >= WIN_SCORE) triggerWin();

      // --- DRAWING ---
      drawWalls();
      drawParticles();
      drawPlayer();
      drawScore(points);
    }

    // --- HELPERS ---
    function spawnWall() {
      const gap = 175;
      const thickness = 55;
      const speed = 5;
      const gapY = Math.random() * (c.height - gap - 100) + 50;
      state.walls.push({ x: c.width, y: 0, w: thickness, h: gapY, vx: -speed });
      state.walls.push({ x: c.width, y: gapY + gap, w: thickness, h: c.height - (gapY + gap), vx: -speed });
    }

    function createParticles(x, y) {
      for(let i=0; i<5; i++) {
        state.particles.push({
          x: x + Math.random()*40,
          y: y,
          vx: (Math.random() - 0.5) * 2,
          vy: Math.random() * 2,
          life: 1.0,
          color: `rgba(255, 255, 255, ${Math.random()})`
        });
      }
    }

    function rectsOverlap(a, b) {
      const pad = 12;
      return a.x + pad < b.x + b.w && a.x + a.w - pad > b.x &&
             a.y + pad < b.y + b.h && a.y + a.h - pad > b.y;
    }

    function drawWalls() {
      ctx.shadowBlur = 0;
      for (const w of state.walls) {
        ctx.fillStyle = "#1e2a36"; 
        ctx.fillRect(w.x, w.y, w.w, w.h);
        ctx.lineWidth = 2;
        ctx.strokeStyle = "#4ef2a8";
        ctx.strokeRect(w.x, w.y, w.w, w.h);
        ctx.fillStyle = "rgba(0,0,0,0.3)";
        ctx.fillRect(w.x + 5, w.y + 5, w.w - 10, w.h - 10);
      }
    }

    function drawParticles() {
      for (let i = state.particles.length - 1; i >= 0; i--) {
        let p = state.particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 0.05;
        if(p.life <= 0) state.particles.splice(i, 1);
        else {
          ctx.fillStyle = p.color;
          ctx.globalAlpha = p.life;
          ctx.beginPath();
          ctx.arc(p.x, p.y, 2, 0, Math.PI*2);
          ctx.fill();
          ctx.globalAlpha = 1.0;
        }
      }
    }

    function drawScore(points) {
      ctx.fillStyle = "rgba(255, 255, 255, 0.1)";
      ctx.beginPath();
      if (ctx.roundRect) ctx.roundRect(15, 15, 140, 50, 10);
      else ctx.rect(15, 15, 140, 50);
      ctx.fill();
      ctx.strokeStyle = "rgba(255, 255, 255, 0.2)";
      ctx.lineWidth = 1;
      ctx.stroke();
      ctx.fillStyle = "#fff";
      ctx.font = "800 24px sans-serif";
      ctx.textAlign = "left";
      ctx.textBaseline = "middle";
      ctx.fillText(points + " / " + WIN_SCORE, 35, 42);
    }

    function drawPlayer() {
      ctx.save();
      ctx.translate(state.player.x + state.player.w/2, state.player.y + state.player.h/2);
      ctx.rotate(state.player.angle);
      ctx.shadowColor = "rgba(0,0,0,0.5)";
      ctx.shadowBlur = 10;
      if (playerImg.complete) {
        ctx.beginPath();
        ctx.arc(0, 0, state.player.w/2, 0, Math.PI*2);
        ctx.clip();
        ctx.drawImage(playerImg, -state.player.w/2, -state.player.h/2, state.player.w, state.player.h);
        ctx.beginPath();
        ctx.arc(0, 0, state.player.w/2, 0, Math.PI*2);
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 3;
        ctx.stroke();
      } else {
        ctx.fillStyle = "#ff4757";
        ctx.beginPath();
        ctx.arc(0, 0, state.player.w/2, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.restore();
    }

    function drawOverlay() {
        ctx.fillStyle = "rgba(15, 23, 42, 0.85)";
        ctx.fillRect(0,0,c.width, c.height);
        ctx.fillStyle = "#ff6b6b";
        ctx.font = "900 48px sans-serif";
        ctx.textAlign = "center";
        ctx.shadowColor = "#ff6b6b";
        ctx.shadowBlur = 20;
        ctx.fillText("CRASHED", c.width/2, c.height/2 - 20);
        ctx.shadowBlur = 0;
        ctx.fillStyle = "#fff";
        ctx.font = "300 18px sans-serif";
        ctx.fillText("Tap anywhere to retry", c.width/2, c.height/2 + 30);
    }

    function die() {
      state.running = false;
      failAudio.currentTime = 0; 
      failAudio.play().catch(e=>{});
    }

    function triggerWin() {
      state.won = true;
      state.walls = []; 
      winAudio.currentTime = 0; 
      winAudio.play().catch(e=>{});
    }

    function drawWinScene() {
      const targetX = c.width / 2 - 60;
      const targetY = c.height / 2;
      state.player.x += (targetX - state.player.x) * 0.05;
      state.player.y += (targetY - state.player.y) * 0.05;
      state.player.angle = 0;
      drawPlayer();
      const prizeX = c.width / 2 + 20;
      const prizeY = c.height / 2 - 40;
      const prizeSize = 80;
      ctx.save();
      ctx.shadowColor = "#f1c40f";
      ctx.shadowBlur = 30;
      if (winImg.complete) {
        ctx.beginPath();
        ctx.arc(prizeX + prizeSize/2, prizeY + prizeSize/2, prizeSize/2, 0, Math.PI*2);
        ctx.clip();
        ctx.drawImage(winImg, prizeX, prizeY, prizeSize, prizeSize);
      } else {
        ctx.fillStyle = "gold";
        ctx.beginPath();
        ctx.arc(prizeX + prizeSize/2, prizeY + prizeSize/2, prizeSize/2, 0, Math.PI*2);
        ctx.fill();
      }
      ctx.restore();
      ctx.fillStyle = "#4ef2a8";
      ctx.font = "900 40px sans-serif";
      ctx.textAlign = "center";
      ctx.shadowColor = "#4ef2a8";
      ctx.shadowBlur = 20;
      ctx.fillText("VICTORY!", c.width/2, c.height/2 - 100);
      if (Math.abs(state.player.x - targetX) < 5) {
         ctx.font = "40px sans-serif";
         ctx.shadowBlur = 0;
         ctx.fillText("❤️", c.width/2, c.height/2 + 10);
      }
    }

    loop();
  </script>
</body>
</html>